<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>认证页面</title>
    <style>
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <form>
        <p>您的身份</p>
        <input type="radio" id="option1" name="admin" value="false">
        <label for="option1">学生</label>
        <input type="radio" id="option2" name="admin" value="true">
        <label for="option2">老师</label>
        <br>
        <label for="realName">真实姓名:</label>
        <br>
        <input type="text" id="realName" placeholder="真名" required>
        <br>
        <label for="introduction">个人介绍:</label>
        <br>
        <textarea placeholder="个人介绍" id="introduction" required rows="4" cols="30">个人介绍</textarea>
        <br>
        <div id = "studentMessage">
            <label for="studentId" class="bound-input">学号:</label>
            <br>
            <input type="text" class="bound-input" placeholder="学号" id="studentId" required>
            <br>
            <label for="college" class="bound-input">学院:</label>
            <br>
            <input type="text" class="bound-input" placeholder="学院" id="college" required>
            <br>
            <label for="major" class="bound-input">专业:</label>
            <br>
            <input type="text" class="bound-input" placeholder="专业" id="major" required>
            <br>
            <label for="grade" class="bound-input">年级：</label>
            <select name="grade" id="grade" class="bound-input">
                <option value="大一">大一</option>
                <option value="大二">大二</option>
                <option value="大三">大三</option>
                <option value="大四">大四</option>
                <option value="研一">研一</option>
                <option value="研二">研二</option>
                <option value="研三">研三</option>
            </select>
            <label for="clazz" class="bound-input">班级:</label>
            <br>
            <input type="text" class="bound-input" placeholder="班级" id="clazz" required>
            <br>
        </div>
        <div id = "teacherMessage">
            <label for="teach" class="bound-input">教授专业:</label>
            <br>
            <input type="text" class="bound-input" placeholder="专业" id="teach" required>
            <br>
            <label for="identifier" class="bound-input">身份验证码:</label>
            <br>
            <input type="text" class="bound-input" placeholder="身份验证码" id="identifier" required>
            <br>
        </div>
        <button id="submitBtn" disabled>上传</button>
    </form>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        var admin = false;
        $('#studentMessage .bound-input').hide();
        $('#teacherMessage .bound-input').hide();
        $('#option1').click(function() {
            if ($(this).is(':checked')) {
                admin = false;
                $('#studentMessage .bound-input').show();
                $('#teacherMessage .bound-input').hide();
                var realName = $('#realName').val();
                var introduction = $('#introduction').val();
                var studentId = $('#studentId').val();
                var college = $('#college').val();
                var major = $('#major').val();
                var grade = $('#grade').val();
                var clazz = $('#clazz').val();
                if (studentId && college && major && grade && clazz && realName && introduction) {
                    $('#submitBtn').prop('disabled', false);
                } else {
                    $('#submitBtn').prop('disabled', true);
                }
            }
        });
        $('#option2').click(function() {
            if ($(this).is(':checked')) {
                admin = true;
                $('#studentMessage .bound-input').hide();
                $('#teacherMessage .bound-input').show();
                var realName = $('#realName').val();
                var introduction = $('#introduction').val();
                var teach = $('#teach').val();
                var identifier = $('#identifier').val();
                if (teach && identifier && realName && introduction) {
                    $('#submitBtn').prop('disabled', false);
                } else {
                    $('#submitBtn').prop('disabled', true);
                }
            }
        });
        $('#realName, #introduction, #studentId, #college, #major, #grade, #class, #teach, #submitBtn').on('input', function (){
            var realName = $('#realName').val();
            var introduction = $('#introduction').val();
            if (realName && introduction) {
                if (!admin) {
                    var studentId = $('#studentId').val();
                    var college = $('#college').val();
                    var major = $('#major').val();
                    var grade = $('#grade').val();
                    var clazz = $('#clazz').val();
                    if (studentId && college && major && grade && clazz) {
                        $('#submitBtn').prop('disabled', false);
                    } else {
                        $('#submitBtn').prop('disabled', true);
                    }
                } else {
                    var teach = $('#teach').val();
                    var identifier = $('#identifier').val();
                    if (teach && identifier) {
                        $('#submitBtn').prop('disabled', false);
                    } else {
                        $('#submitBtn').prop('disabled', true);
                    }
                }
            }
        })
        $('#submitBtn').click(function() {
            var realName = $('#realName').val();
            var introduction = $('#introduction').val();
            if (!admin){
                var studentId = $('#studentId').val();
                var college = $('#college').val();
                var major = $('#major').val();
                var grade = $('#grade').val();
                var clazz = $('#clazz').val();
                $.ajax({
                    url:"http://localhost:8080/ExamDemo_war_exploded/userServlet",
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        method: 'authentication',
                        admin: admin,
                        realName: realName,
                        introduction: introduction,
                        studentId: studentId,
                        college: college,
                        major: major,
                        grade: grade,
                        clazz: clazz
                    }), success: function (response) {
                        if (response.message === "success") {
                            sessionStorage.setItem('token', response.details);
                            alert("认证成功！");
                            window.location.href = 'http://localhost:8080/ExamDemo_war_exploded/home.html';
                        } else {
                            $('#message').text(response.details).show();
                        }
                    }, error: function () {
                        $('#message').text('请求失败，请检查您的网络连接。').show();
                    }
                })
            }else{
                var teach = $('#teach').val();
                var identifier = $('#identifier').val();
                $.ajax({
                    url:"http://localhost:8080/ExamDemo_war_exploded/userServlet",
                    type: 'POST',
                    contentType: 'application/json',
                    beforeSend: function (xhr) {
                        var token = sessionStorage.getItem('token');
                        if (token) {
                            xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                        }
                    }, 
                    data: JSON.stringify({
                        method: 'authentication',
                        admin: admin,
                        realName: realName,
                        introduction: introduction,
                        teach: teach,
                        identifier: identifier
                    }), success: function (response) {
                        if (response.message === "success") {
                            sessionStorage.setItem('token', response.details);
                            alert("认证成功！");
                            window.location.href = 'http://localhost:8080/ExamDemo_war_exploded/home.html';
                        } else {
                            $('#message').text(response.details).show();
                        }
                    }, error: function () {
                        $('#message').text('请求失败，请检查您的网络连接。').show();
                    }
                })
            }
        });
    });
</script>
</html>